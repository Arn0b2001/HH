<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Property Details | HomeScape</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" 
  integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <!-- Include Bootstrap Datepicker CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
  <style>
    /* Custom styles */
    body {
      background-color: #f8f9fa; /* Light gray background */
      color: #333; /* Dark gray text */
      padding-left: 5px; /* Reduce left padding */
      padding-right: 5px; /* Reduce right padding */
    }
    .container {
      max-width: 1200px; /* Set maximum width for better readability */
      margin-top: 30px; /* Add some top margin */
    }
    .navbar-brand {
      font-size: 28px;
      font-weight: bold;
      color: rgb(247, 74, 60); 
      font-family: Tahoma, sans-serif;
    }
    h2.page-title {
      color: rgb(247, 74, 60); 
      margin-bottom: 30px; 
      font-size: 2rem;
      font-family: Tahoma, sans-serif;
      font-style: revert;
    }
    .property-carousel img {
      max-width: 100%;
      max-height: 300px; /* Adjust the maximum height as needed */
      border-radius: 10px;
    }
    .property-image-container {
      margin-bottom: 20px;
    }
    .property-details {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .property-details .detail {
      flex-basis: calc(50% - 10px);
    }
    .property-details .description {
      flex-basis: 100%;
    }
    .property-details .description p {
      margin-bottom: 20px;
    }
    .action-button {
      display: inline-block;
      background-color: rgb(247, 74, 60);
      color: #ffffff;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      text-decoration: none;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px; /* Increased margin-bottom for more padding */
    }
    .action-button:hover {
      background-color: #dc004e; /* Darker shade on hover */
    }
    .guest-box {
      position: relative;
    }
    .guest-options {
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      z-index: 1000;
      display: none;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .guest-options.show {
      display: block;
    }
    .guest-options button {
      margin: 5px;
      padding: 5px 10px;
    }
    /* Datepicker container style */
    .datepicker-container {
      position: relative;
    }
    .datepicker-container .input-group-prepend {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      padding: 0 10px;
      background-color: #fff;
      border: 1px solid #ced4da;
      border-radius: 5px;
    }
    .datepicker-container .input-group-prepend i {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">HomeScape</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>
  
  <div class="container">
    <h2 class="page-title">Royal Lotus Hotel</h2>
    
    <!-- Property images -->
    <div class="property-image-container">
      <div id="property-carousel" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
          <li data-target="" data-slide-to="0" class="active"></li>
          <li data-target="" data-slide-to="1"></li>
          <li data-target="" data-slide-to="2"></li>
        </ol>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="{{property.p_image2.url}}" class="d-block w-100" alt="Property Image 1">
          </div>
          <div class="carousel-item">
            <img src="{{property.p_image3.url}}" class="d-block w-100" alt="Property Image 2">
          </div>
          <div class="carousel-item">
            <img src="{{property.p_image4.url}}" class="d-block w-100" alt="Property Image 3">
          </div>
        </div>
        <a class="carousel-control-prev" href="#property-carousel" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#property-carousel" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    </div>

    <form id="booking-form" method='POST' action="/property_det/{{ property.p_id }}/">
    {%csrf_token%}
    <div class="property-details">
      <div class="description">
        <h3>{{ property.types }} in {{ property.city }}, {{ property.country }}</h3>
        <p>Reconnect with nature at this unforgettable escape. 
            Be it a picturesque sunset or bright starry night!
            Perfect getaway from the hustle of your life and rejuvenate oneself.</p>
      </div>

      <div class="detail">
        <h3>Room Details and Facilities</h3>
        <ul>
          <li>{{property.bed}} Bedroom</li>
          <li>1 Bathroom</li>
          <li>{{property.bed}} common space</li>
          <li>TV</li>
        </ul>
      </div>
      <div class="detail">
        <ul>
          <li>Free Wi-Fi</li>
          <li>Breakfast</li>
          <li>Swimming Pool</li>
          <li>Free Parking</li>
        </ul>
      </div>

      
        <div class="detail">
          <h3>Booking</h3>
          <label for="negotiation-price">Negotiation Price</label>
            <div class="input-group mb-3">
              <input type="number" id="neg_price"  name = "neg_price"  class="form-control" placeholder="Enter negotiation price">
            </div>
          <div class="datepicker-container">
            <label for="check-in">Check-in</label>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
              </div>
              <input type="text" id="check-in" name = "check_in" class="form-control datepicker" placeholder="  Select Check-in Date" readonly>
            </div>
          </div>
          <div class="datepicker-container">
            <label for="check-out">Check-out</label>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
              </div>
              <input type="text" id="check-out" name="check_out" class="form-control datepicker" placeholder="  Select Check-out Date" readonly>
            </div>
          </div>
          <div class="guest-box">
            <label for="guests">Guests</label>
            <input type="text" id="guests" class="form-control" name = 'guests' placeholder="Select Guests" readonly>
            <div id="guest-options" class="guest-options">
              <button type="button" id="adult-minus">-</button>
              <span id="adult-count">1</span> Adult(s)
              <button type="button" id="adult-plus">+</button>
              <br>
              <button type="button" id="child-minus">-</button>
              <span id="child-count">0</span> Child(ren)
              <button type="button" id="child-plus">+</button>
              <br>
              <button type="button" id="infant-minus">-</button>
              <span id="infant-count">0</span> Infant(s)
              <button type="button" id="infant-plus">+</button>
              <br>
              <button type="button" id="close-options">Close</button>
            </div>
          </div>
          <button type="submit" id="book-now-btn" class="action-button" style="margin-top: 25px;">Book Now</button>
        </form>
        </div>
    </div>
  </div>


  <!-- Include Bootstrap Datepicker JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
  <script>
    
    $(document).ready(function() {
      // Sample 'booked' variable with check-in and check-out dates
      var booked = [
          {% for book in booking %}
              {
                  check_in: '{{book.check_in}}',
                  check_out:'{{book.check_out}}'
              },
          {% endfor %}
      ];
      console.log(booked);
   
      // Initialize Bootstrap Datepicker
      $('.datepicker').datepicker({
        format: 'dd/mm/yyyy',
        startDate: 'today',
        autoclose: true,
        beforeShowDay: function(date) {
          var currentDate = date.getDate();
          var currentMonth = date.getMonth() + 1; // Months are 0-based in JavaScript
          var currentYear = date.getFullYear();
          var formattedDate = (currentDate < 10 ? '0' : '') + currentDate + '/' + (currentMonth < 10 ? '0' : '') + currentMonth + '/' + currentYear;
    
          // Check if the formatted date falls within any booked range
          for (var i = 0; i < booked.length; i++) {
            var checkInDate = new Date(booked[i].check_in);
            console.log(checkInDate)
            var checkOutDate = new Date(booked[i].check_out);
    
            // Include the check-in date as available
            if (date >= checkInDate && date <= checkOutDate) {
                return false;
              
            }
          }
    
          return true; // All other dates are available
        }
      });
  
      // Function to update guest count
      function updateGuestCount(type, action) {
        const countElement = $(`#${type}-count`);
        let count = parseInt(countElement.text());
  
        if (type === 'adult' && action === 'decrement' && count <= 1) {
          return; // Prevent decrementing adult count below 1
        }
  
        if (action === 'increment' && count < 2) {
          count++;
        } else if (action === 'decrement' && count > 0) {
          count--;
        }
  
        countElement.text(count);
        updateGuestsInput();
      }
  
      // Update the hidden input field with selected guests count
      function updateGuestsInput() {
        const adults = parseInt($('#adult-count').text());
        const children = parseInt($('#child-count').text());
        const infants = parseInt($('#infant-count').text());
        const totalGuests = adults + children + infants;
  
        $('#guests').val(`${totalGuests} Guests (${adults} Adults, ${children} Children, ${infants} Infants)`);
      }
  
      // Event listeners for increment/decrement buttons
      $('#adult-plus').click(function(e) {
        e.stopPropagation();
        updateGuestCount('adult', 'increment');
        updateGuestsInput();
      });
  
      $('#adult-minus').click(function(e) {
        e.stopPropagation();
        updateGuestCount('adult', 'decrement');
        updateGuestsInput();
      });
  
      $('#child-plus').click(function(e) {
        e.stopPropagation();
        updateGuestCount('child', 'increment');
        updateGuestsInput();
      });
  
      $('#child-minus').click(function(e) {
        e.stopPropagation();
        updateGuestCount('child', 'decrement');
        updateGuestsInput();
      });
  
      $('#infant-plus').click(function(e) {
        e.stopPropagation();
        updateGuestCount('infant', 'increment');
        updateGuestsInput();
      });
  
      $('#infant-minus').click(function(e) {
        e.stopPropagation();
        updateGuestCount('infant', 'decrement');
        updateGuestsInput();
      });
  
      // Show/hide guest options on click
      $('.guest-box').click(function() {
        $('.guest-options').toggleClass('show');
      });
  
      // Close guest options on close button click
      $('#close-options').click(function(e) {
        e.stopPropagation();
        $('.guest-options').removeClass('show');
      });
  
      // Form submission and validation
      $('#book-now-btn').click(function(e) {
        e.preventDefault(); // Prevent default button behavior
        
        const selectedGuests = $('#guests').val();
        const checkInDate = $('#check-in').datepicker('getDate'); // Get Date object from Datepicker
        const checkOutDate = $('#check-out').datepicker('getDate'); // Get Date object from Datepicker
       
        var booked = [
            {% for book in booking %}
                {
                    check_in: '{{book.check_in}}',
                    check_out:'{{book.check_out}}'
                },
            {% endfor %}
        ];
        let x = true;
        for (var i = 0; i < booked.length; i++) {
          var bookedcheckInDate = new Date(booked[i].check_in);
          var bookedcheckOutDate = new Date(booked[i].check_out);

          if (bookedcheckInDate >= checkInDate && bookedcheckInDate <= checkOutDate) {
            x = false;
            break;
          }

          if (bookedcheckOutDate >= checkInDate && bookedcheckOutDate <= checkOutDate) {
            x = false;
            break;
          }
        }

          
        
        
        // Validate dates and guests before booking
        if (x){
          if (!checkInDate || !checkOutDate) {
            alert('Please select valid check-in and check-out dates.');
          } else if (checkInDate >= checkOutDate) {
            alert('Check-out date should be after the check-in date.');
          } else if (selectedGuests === '') {
            alert('Please select the number of guests.');
          } else {
            // Optionally, submit the form
            $('#booking-form').submit();
          }
        } else {
          alert('The date is already booked');
        }
      });
  
      // Initialize guest count and input field
      updateGuestsInput();
    });
  </script>
</body>
</html>
